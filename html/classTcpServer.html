<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SockIt: TcpServer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SockIt</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<h1>TcpServer Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="TcpServer" --><!-- doxytag: inherits="Tcp,Server" -->
<p><code>#include &lt;<a class="el" href="TcpServer_8h_source.html">TcpServer.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for TcpServer:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classTcpServer.png" usemap="#TcpServer_map" alt=""/>
  <map id="TcpServer_map" name="TcpServer_map">
<area href="classTcp.html" alt="Tcp" shape="rect" coords="0,56,95,80"/>
<area href="classServer.html" alt="Server" shape="rect" coords="105,56,200,80"/>
<area href="classNetworkObject.html" alt="NetworkObject" shape="rect" coords="105,0,200,24"/>
</map>
 </div></div>

<p><a href="classTcpServer-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a6c573fc4b33ec7c841afb400a061a08f">TcpServer</a> (int <a class="el" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, boost::asio::io_service &amp;<a class="el" href="classTcp.html#ad0c319a0974aa3f07e9c5ae290ea18b4">io_service</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a7b8c4471aba48774b338b5bc5c4cb310">TcpServer</a> (int <a class="el" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, boost::asio::io_service &amp;<a class="el" href="classTcp.html#ad0c319a0974aa3f07e9c5ae290ea18b4">io_service</a>, map&lt; string, string &gt; options)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a728a9e31c53cf86887f1f6149b1c46dd">~TcpServer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#ad16f797335dd9c54eaec93c35d158569">start_listening</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a918898ee7b13d776a2f7ea8968168669">shutdown</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a65be01f9466447530de3112d538267b4">get_port</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#afb381d332f0169ac7b1dc3d97de93239">FB_JSAPI_EVENT</a> (disconnect, 1,(const string &amp;))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a0ef55e7e09a51df56c4d1a76e4bda573">FB_JSAPI_EVENT</a> (connect, 0,())</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a99739644296c7c2647022695d0d0bdbe">receive_handler</a> (const boost::system::error_code &amp;error_code, std::size_t bytesTransferred, boost::shared_ptr&lt; tcp::socket &gt; connection, string <a class="el" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>, int <a class="el" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a07ef4a083656e07099f615d34d3627a1">fire_error_event</a> (const string &amp;message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#aef3b4f4665d3fab448008201915f1fd5">fire_disconnect_event</a> (const string &amp;message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a49708224d7eb73b2371b53d672b626e5">fire_data_event</a> (const string data, boost::shared_ptr&lt; tcp::socket &gt; connection)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a6e94bd28e3d3d506609df98afb94c879">close</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a64291f0ad4b590f32414ca93fffd13f0">init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a6906e0426ba0dc59b4103478a886be46">init_socket</a> (boost::shared_ptr&lt; tcp::socket &gt; connection)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#abf9de49e9fca80c26eb5143bea332eaa">TcpServer</a> (const <a class="el" href="classTcpServer.html">TcpServer</a> &amp;other)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#ac07bb7a42599e9f90f67a11bcba2285e">accept_handler</a> (const boost::system::error_code &amp;error_code, boost::shared_ptr&lt; tcp::socket &gt; connection, string <a class="el" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>, int <a class="el" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>)</td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">boost::shared_ptr&lt; tcp::acceptor &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">set&lt; boost::shared_ptr<br class="typebreak"/>
&lt; tcp::socket &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTcpServer.html#a1beafdc19eb3f4e18fb811057afe5f6d">connections</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This class represents a TCP server, which inherits basic TCP handling functionality from <code><a class="el" href="classTcp.html">Tcp</a></code>, and defines additional functionality to bind to a port and accept incoming connections. </p>

<p>Definition at line <a class="el" href="TcpServer_8h_source.html#l00024">24</a> of file <a class="el" href="TcpServer_8h_source.html">TcpServer.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a6c573fc4b33ec7c841afb400a061a08f"></a><!-- doxytag: member="TcpServer::TcpServer" ref="a6c573fc4b33ec7c841afb400a061a08f" args="(int port, boost::asio::io_service &amp;io_service)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::TcpServer </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::asio::io_service &amp;&#160;</td>
          <td class="paramname"><em>io_service</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Builds a TCP server to listen on the specified port, but does not start the server listening on it. Using this constructor uses IPv4, given an I/O service to use for asynchronous I/O.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>The port on which the server should listen </td></tr>
    <tr><td class="paramname">io_service</td><td>The I/O service to use for background I/O requests </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00010">10</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="TcpServer_8cpp_source.html#l00071">init()</a>.</p>
<div class="fragment"><pre class="fragment">                                                               :
    <a class="code" href="classTcp.html#af081afa2fd34edc12ac0dda43851352c">Tcp</a>(<span class="stringliteral">&quot;SERVER&quot;</span>, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#ad0c319a0974aa3f07e9c5ae290ea18b4">io_service</a>)
{
    <a class="code" href="classTcpServer.html#a64291f0ad4b590f32414ca93fffd13f0">init</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7b8c4471aba48774b338b5bc5c4cb310"></a><!-- doxytag: member="TcpServer::TcpServer" ref="a7b8c4471aba48774b338b5bc5c4cb310" args="(int port, boost::asio::io_service &amp;io_service, map&lt; string, string &gt; options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::TcpServer </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::asio::io_service &amp;&#160;</td>
          <td class="paramname"><em>io_service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; string, string &gt;&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Builds a TCP server to listen on the specified port, but does not start the server listening on it. Using this constructor creates a server using IPv6, given an I/O service to use for asynchronous I/O.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>The port on which the server should listen </td></tr>
    <tr><td class="paramname">io_service</td><td>The I/O service to use for background I/O requests </td></tr>
    <tr><td class="paramname">options</td><td>A map of options specifying the behavior of the socket </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00016">16</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="TcpServer_8cpp_source.html#l00071">init()</a>, and <a class="el" href="Tcp_8cpp_source.html#l00197">Tcp::parse_args()</a>.</p>
<div class="fragment"><pre class="fragment">                                                                                            :
    <a class="code" href="classTcp.html#af081afa2fd34edc12ac0dda43851352c">Tcp</a>(<span class="stringliteral">&quot;SERVER&quot;</span>, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#ad0c319a0974aa3f07e9c5ae290ea18b4">io_service</a>)
{
    <a class="code" href="classTcp.html#a65753a8c2d9bad07216abdcd5a8a1e86">parse_args</a>(options);
    <a class="code" href="classTcpServer.html#a64291f0ad4b590f32414ca93fffd13f0">init</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a728a9e31c53cf86887f1f6149b1c46dd"></a><!-- doxytag: member="TcpServer::~TcpServer" ref="a728a9e31c53cf86887f1f6149b1c46dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::~TcpServer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Deconstructs this TCP server, by immediately ceasing to accept incoming connections, shutdown all necessary resources. </p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00023">23</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="TcpServer_8cpp_source.html#l00028">close()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classTcpServer.html#a6e94bd28e3d3d506609df98afb94c879">close</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="abf9de49e9fca80c26eb5143bea332eaa"></a><!-- doxytag: member="TcpServer::TcpServer" ref="abf9de49e9fca80c26eb5143bea332eaa" args="(const TcpServer &amp;other)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::TcpServer </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classTcpServer.html">TcpServer</a> &amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Disallows copying a TCP server </p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ac07bb7a42599e9f90f67a11bcba2285e"></a><!-- doxytag: member="TcpServer::accept_handler" ref="ac07bb7a42599e9f90f67a11bcba2285e" args="(const boost::system::error_code &amp;error_code, boost::shared_ptr&lt; tcp::socket &gt; connection, string host, int port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::accept_handler </td>
          <td>(</td>
          <td class="paramtype">const boost::system::error_code &amp;&#160;</td>
          <td class="paramname"><em>error_code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; tcp::socket &gt;&#160;</td>
          <td class="paramname"><em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handler invoked when a new connection is made to this server. This handler tries to start receiving data from the new incoming connection if there was no error accepting the connection.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">error_code</td><td>The error code encountered when trying to receive data, if any occurred. On success, this value is zero, and nonzero on error. </td></tr>
    <tr><td class="paramname">connection</td><td>The new connection created by this accept, from which this function will attempt to receive data. </td></tr>
    <tr><td class="paramname">host</td><td>The host from which this accept was attempted </td></tr>
    <tr><td class="paramname">port</td><td>The port from which this accept was attempted </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00218">218</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="Tcp_8h_source.html#l00276">Tcp::disconnect_errors</a>, <a class="el" href="Logger_8h_source.html#l00071">Logger::error()</a>, <a class="el" href="Logger_8h_source.html#l00084">Logger::info()</a>, <a class="el" href="TcpServer_8cpp_source.html#l00105">init_socket()</a>, <a class="el" href="Tcp_8h_source.html#l00214">Tcp::receive_buffer</a>, <a class="el" href="TcpServer_8cpp_source.html#l00275">receive_handler()</a>, <a class="el" href="TcpServer_8cpp_source.html#l00164">start_listening()</a>, <a class="el" href="Tcp_8h_source.html#l00224">Tcp::waiting_to_shutdown</a>, and <a class="el" href="Logger_8h_source.html#l00097">Logger::warn()</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00164">start_listening()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Log error &amp; return if there is an error</span>
    <span class="keywordflow">if</span> (error_code)
    {
        <span class="comment">// Check for disconnection errors</span>
        std::set&lt;boost::system::error_code&gt;::iterator find_result = <a class="code" href="classTcp.html#adcbc3e86d98f8ba37247674cf67f77fd">disconnect_errors</a>.find(error_code);
        <span class="keywordflow">if</span> (find_result != <a class="code" href="classTcp.html#adcbc3e86d98f8ba37247674cf67f77fd">disconnect_errors</a>.end())
        {
            <span class="keywordflow">if</span> (error_code == boost::asio::error::operation_aborted)
            {
                <span class="comment">// If we&#39;re waiting to shutdown, this is part of the normal process</span>
                <span class="keywordflow">if</span>(<a class="code" href="classTcp.html#a96b0558a6ce522708bfd06cf1e6e45ba">waiting_to_shutdown</a>)
                {
                    <a class="code" href="classLogger.html#a8c7d9b42b9a5480dceed15a21a2d57c6">Logger::info</a>(<span class="stringliteral">&quot;TCP server stopped listening for new connections&quot;</span>, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
                }
                <span class="keywordflow">else</span>
                {
                    <a class="code" href="classLogger.html#ae0ebb73647360cb425de15cb9790563d">Logger::warn</a>(<span class="stringliteral">&quot;TCP accept was aborted&quot;</span>, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
                }
            }
            <span class="keywordflow">else</span>
            {
                <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;TCP accept failed, disconnected: &#39;&quot;</span> + error_code.message() + <span class="stringliteral">&quot;&#39;&quot;</span>);
                <a class="code" href="classLogger.html#ae0ebb73647360cb425de15cb9790563d">Logger::warn</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
                fire_disconnect(message);
            }
            <span class="keywordflow">return</span>;
        }

        <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;Error accepting incoming connection: &#39;&quot;</span> + error_code.message() + <span class="stringliteral">&quot;&#39;&quot;</span>);
        <a class="code" href="classLogger.html#adb709be72ac3e448f2af97b9cafaef2f">Logger::error</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
        fire_error(message);
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// Initialize the socket options before we start using it</span>
    <a class="code" href="classTcpServer.html#a6906e0426ba0dc59b4103478a886be46">init_socket</a>(connection);

    <span class="comment">// Log that we&#39;ve successfully accepted a new connection, and fire the &#39;onconnect&#39; event</span>
    <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;TCP server accepted new connection from &quot;</span> + connection-&gt;remote_endpoint().address().to_string() + <span class="stringliteral">&quot; port &quot;</span>
            + boost::lexical_cast&lt;<span class="keywordtype">string</span>&gt;(connection-&gt;remote_endpoint().port()));
    <a class="code" href="classLogger.html#a8c7d9b42b9a5480dceed15a21a2d57c6">Logger::info</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
    fire_connect();

    <span class="keywordflow">if</span> (connection.get())
        connection-&gt;async_receive(boost::asio::buffer(<a class="code" href="classTcp.html#aeb630e95d24f26852437098df5896b16">receive_buffer</a>),
                boost::bind(&amp;<a class="code" href="classTcpServer.html#a99739644296c7c2647022695d0d0bdbe">TcpServer::receive_handler</a>, <span class="keyword">this</span>, _1, _2, connection, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>));

    <span class="comment">// Start listening for new connections, if we&#39;re not waiting to close</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classTcp.html#a96b0558a6ce522708bfd06cf1e6e45ba">waiting_to_shutdown</a>)
    {
        <a class="code" href="classTcpServer.html#ad16f797335dd9c54eaec93c35d158569">start_listening</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6e94bd28e3d3d506609df98afb94c879"></a><!-- doxytag: member="TcpServer::close" ref="a6e94bd28e3d3d506609df98afb94c879" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::close </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Closes down this TCP server immediately, by immediately ceasing to accept incoming connections, shutdown all necessary resources. </p>

<p>Implements <a class="el" href="classTcp.html#a48b0192669ab99dc953ab3feae5c1b1c">Tcp</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00028">28</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="TcpServer_8h_source.html#l00159">acceptor</a>, <a class="el" href="TcpServer_8h_source.html#l00162">connections</a>, <a class="el" href="Tcp_8h_source.html#l00264">Tcp::host</a>, <a class="el" href="Tcp_8h_source.html#l00269">Tcp::port</a>, <a class="el" href="Tcp_8h_source.html#l00224">Tcp::waiting_to_shutdown</a>, and <a class="el" href="Logger_8h_source.html#l00097">Logger::warn()</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00199">shutdown()</a>, and <a class="el" href="TcpServer_8cpp_source.html#l00023">~TcpServer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Shutdown the IO service, cancel any transfers on the socket, and close the socket</span>
    <a class="code" href="classTcp.html#a96b0558a6ce522708bfd06cf1e6e45ba">waiting_to_shutdown</a> = <span class="keyword">true</span>;

    set&lt;boost::shared_ptr&lt;tcp::socket&gt; &gt;::iterator it;
    <span class="keywordflow">for</span>(it = <a class="code" href="classTcpServer.html#a1beafdc19eb3f4e18fb811057afe5f6d">connections</a>.begin(); it != <a class="code" href="classTcpServer.html#a1beafdc19eb3f4e18fb811057afe5f6d">connections</a>.end(); it++)
    {
        <span class="keywordflow">try</span>
        {
            <span class="keywordflow">if</span>((*it) &amp;&amp; (*it).get() &amp;&amp; (*it)-&gt;is_open())
            {
                (*it)-&gt;close();
            }
        }
        <span class="keywordflow">catch</span>(boost::system::error_code &amp;e)
        {
            <a class="code" href="classLogger.html#ae0ebb73647360cb425de15cb9790563d">Logger::warn</a>(<span class="stringliteral">&quot;Error in TcpServer deconstructor: &quot;</span> + e.message(), <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
        }
        <span class="keywordflow">catch</span>(std::exception &amp;er)
        {
            <a class="code" href="classLogger.html#ae0ebb73647360cb425de15cb9790563d">Logger::warn</a>(<span class="stringliteral">&quot;Error in TcpServer deconstructor: &quot;</span> + std::string(er.what()), <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
        }
        <span class="keywordflow">catch</span>(...)
        {
            <a class="code" href="classLogger.html#ae0ebb73647360cb425de15cb9790563d">Logger::warn</a>(<span class="stringliteral">&quot;Error occured that could not be caught&quot;</span>);
        }
    }

    <a class="code" href="classTcpServer.html#a1beafdc19eb3f4e18fb811057afe5f6d">connections</a>.clear();

    <span class="keywordflow">if</span> (<a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a> &amp;&amp; <a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a>-&gt;is_open())
    {
        <a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a>-&gt;close();
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// Don&#39;t fire an error, otherwise the plugin will crash</span>
        <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;Could not cleanly shut down acceptor in TCP server, desctructing anyways&quot;</span>);
        <a class="code" href="classLogger.html#ae0ebb73647360cb425de15cb9790563d">Logger::warn</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="afb381d332f0169ac7b1dc3d97de93239"></a><!-- doxytag: member="TcpServer::FB_JSAPI_EVENT" ref="afb381d332f0169ac7b1dc3d97de93239" args="(disconnect, 1,(const string &amp;))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::FB_JSAPI_EVENT </td>
          <td>(</td>
          <td class="paramtype">disconnect&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">1&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">(const string &amp;)&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The javascript event fired on a disconnect-type network error. This is fired on the following <code>boost</code> errors: </p>
<ul>
<li>
<code>boost::asio::error::connection_reset</code> </li>
<li>
<code>boost::asio::error::eof</code> </li>
<li>
<code>boost::asio::error::connection_aborted</code> </li>
<li>
<code>boost::asio::error::operation_aborted</code> </li>
</ul>

</div>
</div>
<a class="anchor" id="a0ef55e7e09a51df56c4d1a76e4bda573"></a><!-- doxytag: member="TcpServer::FB_JSAPI_EVENT" ref="a0ef55e7e09a51df56c4d1a76e4bda573" args="(connect, 0,())" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::FB_JSAPI_EVENT </td>
          <td>(</td>
          <td class="paramtype">connect&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">0&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">()&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The javascript event fired once a client has connected to its remote endpoint, or once a server has accepted a connection successfully (but has not yet receieved data), in this class, the former. </p>

</div>
</div>
<a class="anchor" id="a49708224d7eb73b2371b53d672b626e5"></a><!-- doxytag: member="TcpServer::fire_data_event" ref="a49708224d7eb73b2371b53d672b626e5" args="(const string data, boost::shared_ptr&lt; tcp::socket &gt; connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::fire_data_event </td>
          <td>(</td>
          <td class="paramtype">const string&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; tcp::socket &gt;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Helper to fire data event to javascript.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>The data received </td></tr>
    <tr><td class="paramname">connection</td><td>The connection on which to reply to the data </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classTcp.html#a7e5cfd764f04ca5e2729924b9d537db2">Tcp</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00299">299</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    fire_data(boost::make_shared&lt;TcpEvent&gt;(<span class="keyword">this</span>, connection, data));
}
</pre></div>
</div>
</div>
<a class="anchor" id="aef3b4f4665d3fab448008201915f1fd5"></a><!-- doxytag: member="TcpServer::fire_disconnect_event" ref="aef3b4f4665d3fab448008201915f1fd5" args="(const string &amp;message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::fire_disconnect_event </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Helper to fire an disconnect error event to javascript.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The error message </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classTcp.html#a69d92d55403e877f252bbfbfd7c02ec2">Tcp</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00294">294</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    fire_disconnect(message);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a07ef4a083656e07099f615d34d3627a1"></a><!-- doxytag: member="TcpServer::fire_error_event" ref="a07ef4a083656e07099f615d34d3627a1" args="(const string &amp;message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::fire_error_event </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Helper to fire an error event to javascript.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>The error message </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classTcp.html#a9798750750bc775de9a16d0f148bc002">Tcp</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00289">289</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
    fire_error(message);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a65be01f9466447530de3112d538267b4"></a><!-- doxytag: member="TcpServer::get_port" ref="a65be01f9466447530de3112d538267b4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TcpServer::get_port </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns the port on which this server listens </p>

<p>Implements <a class="el" href="classServer.html#abd497ca7e7dc29f8ea4c6ce204839a6d">Server</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00284">284</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="Tcp_8h_source.html#l00269">Tcp::port</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a64291f0ad4b590f32414ca93fffd13f0"></a><!-- doxytag: member="TcpServer::init" ref="a64291f0ad4b590f32414ca93fffd13f0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Helper function to initialize the acceptor. If this was not successfully initialized, <code>fail</code> is true. </p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00071">71</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="TcpServer_8h_source.html#l00159">acceptor</a>, <a class="el" href="Logger_8h_source.html#l00071">Logger::error()</a>, <a class="el" href="Tcp_8h_source.html#l00281">Tcp::failed</a>, <a class="el" href="Tcp_8h_source.html#l00264">Tcp::host</a>, <a class="el" href="Tcp_8h_source.html#l00219">Tcp::io_service</a>, <a class="el" href="Tcp_8h_source.html#l00269">Tcp::port</a>, and <a class="el" href="Tcp_8h_source.html#l00229">Tcp::using_ipv6</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00010">TcpServer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Bind the acceptor to the correct port &amp; set the options on this acceptor</span>
    <span class="keywordflow">try</span>
    {
        <span class="keywordflow">if</span> (<a class="code" href="classTcp.html#a395b2458742a84d78c1107ac8b59a7a8">using_ipv6</a> &amp;&amp; *<a class="code" href="classTcp.html#a395b2458742a84d78c1107ac8b59a7a8">using_ipv6</a>)
        {
            <a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a> = boost::shared_ptr&lt;tcp::acceptor&gt;(<span class="keyword">new</span> <a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">tcp::acceptor</a>(<a class="code" href="classTcp.html#ad0c319a0974aa3f07e9c5ae290ea18b4">io_service</a>, tcp::endpoint(tcp::v6(), <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>)));
        }
        <span class="keywordflow">else</span>
        {
            <a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a> = boost::shared_ptr&lt;tcp::acceptor&gt;(<span class="keyword">new</span> <a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">tcp::acceptor</a>(<a class="code" href="classTcp.html#ad0c319a0974aa3f07e9c5ae290ea18b4">io_service</a>, tcp::endpoint(tcp::v4(), <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>)));
        }
    }
    <span class="keywordflow">catch</span> (boost::system::system_error &amp;e)
    {
        <span class="comment">// Catch this error, and fail gracefully</span>
        <span class="keywordtype">string</span> message(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Caught error initializing TCP server: &#39;&quot;</span>) + e.what() + <span class="stringliteral">&quot;&#39;&quot;</span>);
        <a class="code" href="classLogger.html#adb709be72ac3e448f2af97b9cafaef2f">Logger::error</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);

        <span class="comment">// Stop this server from ever doing anything again</span>
        <a class="code" href="classTcp.html#a9dbc59f5343aa045be1a888356ef6fbf">failed</a> = <span class="keyword">true</span>;
    }

    <span class="comment">// Check that acceptor was created successfully</span>
    <span class="keywordflow">if</span> (!<a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a>.get())
    {
        <span class="comment">// Fail gracefully and stop this server from ever doing anything again</span>
        <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;Failed to initialized TCP server acceptor&quot;</span>);
        <a class="code" href="classLogger.html#adb709be72ac3e448f2af97b9cafaef2f">Logger::error</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
        <a class="code" href="classTcp.html#a9dbc59f5343aa045be1a888356ef6fbf">failed</a> = <span class="keyword">true</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6906e0426ba0dc59b4103478a886be46"></a><!-- doxytag: member="TcpServer::init_socket" ref="a6906e0426ba0dc59b4103478a886be46" args="(boost::shared_ptr&lt; tcp::socket &gt; connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::init_socket </td>
          <td>(</td>
          <td class="paramtype">boost::shared_ptr&lt; tcp::socket &gt;&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the properties of this socket </p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00105">105</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="Tcp_8h_source.html#l00239">Tcp::do_not_route</a>, <a class="el" href="Tcp_8h_source.html#l00244">Tcp::keep_alive</a>, <a class="el" href="Tcp_8h_source.html#l00249">Tcp::keep_alive_timeout</a>, <a class="el" href="Tcp_8h_source.html#l00234">Tcp::no_delay</a>, and <a class="el" href="Tcp_8cpp_source.html#l00243">Tcp::set_tcp_keepalive()</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00218">accept_handler()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// Set the socket options for this client&#39;s TCP socket</span>
    <span class="keywordflow">if</span> (<a class="code" href="classTcp.html#a6bff7fed84126b745930da36030c68c7">do_not_route</a>)
    {
        boost::asio::socket_base::do_not_route option(*<a class="code" href="classTcp.html#a6bff7fed84126b745930da36030c68c7">do_not_route</a>);
        connection-&gt;set_option(option);
    }

    <span class="comment">// Toggle keep alive (enabled/disabled)</span>
    <span class="keywordflow">if</span> (<a class="code" href="classTcp.html#a5cec5af76ec94551f8dc5f98639e9953">keep_alive</a>)
    {
        boost::asio::socket_base::keep_alive option(*<a class="code" href="classTcp.html#a5cec5af76ec94551f8dc5f98639e9953">keep_alive</a>);
        connection-&gt;set_option(option);
    }
    <span class="keywordflow">if</span> (<a class="code" href="classTcp.html#a00a788b6d5b91b31b340f942617b9dda">no_delay</a>)
    {
        boost::asio::ip::tcp::no_delay option(*<a class="code" href="classTcp.html#a00a788b6d5b91b31b340f942617b9dda">no_delay</a>);
        connection-&gt;set_option(option);
    }

    <span class="keywordflow">if</span> (<a class="code" href="classTcp.html#a08e171f501f01c117f5a3c04d394d137">keep_alive_timeout</a>)
    {
        <span class="comment">// Set the TCP keep-alive timeout - ignores return value</span>
        <a class="code" href="classTcp.html#aea9e4a82b08f1893900dad21a1fedfb7">set_tcp_keepalive</a>(connection);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a99739644296c7c2647022695d0d0bdbe"></a><!-- doxytag: member="TcpServer::receive_handler" ref="a99739644296c7c2647022695d0d0bdbe" args="(const boost::system::error_code &amp;error_code, std::size_t bytesTransferred, boost::shared_ptr&lt; tcp::socket &gt; connection, string host, int port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::receive_handler </td>
          <td>(</td>
          <td class="paramtype">const boost::system::error_code &amp;&#160;</td>
          <td class="paramname"><em>error_code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>bytesTransferred</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">boost::shared_ptr&lt; tcp::socket &gt;&#160;</td>
          <td class="paramname"><em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Inherited from <a class="el" href="classTcp.html">Tcp</a>. Handler invoked when the data has been sent (or sending terminated in error). </p>

<p>Reimplemented from <a class="el" href="classTcp.html#a96707e496b0fcef660c3f22fb6efc0fd">Tcp</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00275">275</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="TcpServer_8h_source.html#l00162">connections</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00218">accept_handler()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="classTcpServer.html#a99739644296c7c2647022695d0d0bdbe">Tcp::receive_handler</a>(error_code, bytesTransferred, connection, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>);

    <span class="keywordflow">if</span>(connection &amp;&amp; connection.get() &amp;&amp; !connection-&gt;is_open())
        <a class="code" href="classTcpServer.html#a1beafdc19eb3f4e18fb811057afe5f6d">connections</a>.erase(connection);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a918898ee7b13d776a2f7ea8968168669"></a><!-- doxytag: member="TcpServer::shutdown" ref="a918898ee7b13d776a2f7ea8968168669" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::shutdown </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Gracefully shutdown this TCP server, waiting until all sends have completed before freeing all resources for this TCP server and shutting down any open connections. This function is exposed the javascript API. </p>

<p>Implements <a class="el" href="classNetworkObject.html#a2f519457fd87c8a92cf265a2b2883e96">NetworkObject</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00199">199</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="Tcp_8h_source.html#l00254">Tcp::active_jobs</a>, <a class="el" href="TcpServer_8cpp_source.html#l00028">close()</a>, <a class="el" href="Logger_8h_source.html#l00071">Logger::error()</a>, <a class="el" href="Tcp_8h_source.html#l00281">Tcp::failed</a>, <a class="el" href="Tcp_8h_source.html#l00264">Tcp::host</a>, <a class="el" href="Tcp_8h_source.html#l00269">Tcp::port</a>, and <a class="el" href="Tcp_8h_source.html#l00224">Tcp::waiting_to_shutdown</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>(!<a class="code" href="classTcp.html#a9dbc59f5343aa045be1a888356ef6fbf">failed</a>)
    {
        <a class="code" href="classTcp.html#a96b0558a6ce522708bfd06cf1e6e45ba">waiting_to_shutdown</a> = <span class="keyword">true</span>;
        <span class="keywordflow">if</span> (<a class="code" href="classTcp.html#a4811b96fe77f74f10b14aac532036708">active_jobs</a> == 0)
        {
            fire_close();
            <a class="code" href="classTcpServer.html#a6e94bd28e3d3d506609df98afb94c879">close</a>();
        }
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// Log &amp; fire an error</span>
        <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;Trying to shutdown the TCP server, but the server has permanently failed!&quot;</span>);
        <a class="code" href="classLogger.html#adb709be72ac3e448f2af97b9cafaef2f">Logger::error</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad16f797335dd9c54eaec93c35d158569"></a><!-- doxytag: member="TcpServer::start_listening" ref="ad16f797335dd9c54eaec93c35d158569" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::start_listening </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Called to start the the server listening for the first time, fires the 'open' event, and is exposed to the javascript. This should only be called once, and starts the server listening for incoming connections. </p>

<p>Implements <a class="el" href="classServer.html#ab60269481230955b94dc6405162794b0">Server</a>.</p>

<p>Definition at line <a class="el" href="TcpServer_8cpp_source.html#l00164">164</a> of file <a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a>.</p>

<p>References <a class="el" href="TcpServer_8cpp_source.html#l00218">accept_handler()</a>, <a class="el" href="TcpServer_8h_source.html#l00159">acceptor</a>, <a class="el" href="TcpServer_8h_source.html#l00162">connections</a>, <a class="el" href="Logger_8h_source.html#l00071">Logger::error()</a>, <a class="el" href="Tcp_8h_source.html#l00281">Tcp::failed</a>, <a class="el" href="Tcp_8h_source.html#l00264">Tcp::host</a>, <a class="el" href="Logger_8h_source.html#l00084">Logger::info()</a>, <a class="el" href="Tcp_8h_source.html#l00219">Tcp::io_service</a>, <a class="el" href="Tcp_8h_source.html#l00269">Tcp::port</a>, and <a class="el" href="TcpServer_8cpp_source.html#l00138">socket_deallocate()</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00218">accept_handler()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>(<a class="code" href="classTcp.html#a9dbc59f5343aa045be1a888356ef6fbf">failed</a>)
    {
        <span class="comment">// Log &amp; fire an error</span>
        <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;Trying to start the server listening, but the server has permanently failed!&quot;</span>);
        <a class="code" href="classLogger.html#adb709be72ac3e448f2af97b9cafaef2f">Logger::error</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
    }

    <span class="comment">// Log listening</span>
    <a class="code" href="classLogger.html#a8c7d9b42b9a5480dceed15a21a2d57c6">Logger::info</a>(<span class="stringliteral">&quot;TCP server about to start listening for incoming connections on port &quot;</span>
            + boost::lexical_cast&lt;string&gt;(<a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>), <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);

    <span class="comment">// Prepare to accept a new connection and asynchronously accept new incoming connections</span>
    boost::shared_ptr &lt; tcp::socket &gt; connection(<span class="keyword">new</span> tcp::socket(<a class="code" href="classTcp.html#ad0c319a0974aa3f07e9c5ae290ea18b4">io_service</a>), <a class="code" href="TcpServer_8cpp.html#ac9dd6924c09e22e8976648dfb53b9d77">socket_deallocate</a>);
    <a class="code" href="classTcpServer.html#a1beafdc19eb3f4e18fb811057afe5f6d">connections</a>.insert(connection);

    <span class="comment">// Try to accept any new connection</span>
    <span class="keywordflow">if</span>(<a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a>.get())
    {
        <a class="code" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">acceptor</a>-&gt;async_accept(*connection, boost::bind(&amp;<a class="code" href="classTcpServer.html#ac07bb7a42599e9f90f67a11bcba2285e">TcpServer::accept_handler</a>, <span class="keyword">this</span>, _1, connection, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>));
    }
    <span class="keywordflow">else</span>
    {
        <span class="comment">// Fail gracefully and stop this server from ever doing anything again</span>
        <span class="keywordtype">string</span> message(<span class="stringliteral">&quot;TCP server failed to accept, acceptor invalid&quot;</span>);
        <a class="code" href="classLogger.html#adb709be72ac3e448f2af97b9cafaef2f">Logger::error</a>(message, <a class="code" href="classTcp.html#a7ed15f78afc9d0675404b4b41cc723ba">port</a>, <a class="code" href="classTcp.html#a0e981d15f94a460b91845bce9b930c61">host</a>);
        <a class="code" href="classTcp.html#a9dbc59f5343aa045be1a888356ef6fbf">failed</a> = <span class="keyword">true</span>;
        <span class="keywordflow">return</span>;
    }

    <span class="comment">// Callback acknowledging that the server has opened</span>
    fire_open();
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aa6b754f18b1c444bf6f1af263be18f33"></a><!-- doxytag: member="TcpServer::acceptor" ref="aa6b754f18b1c444bf6f1af263be18f33" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt;tcp::acceptor&gt; <a class="el" href="classTcpServer.html#aa6b754f18b1c444bf6f1af263be18f33">TcpServer::acceptor</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The acceptor for incoming connections for this server </p>

<p>Definition at line <a class="el" href="TcpServer_8h_source.html#l00159">159</a> of file <a class="el" href="TcpServer_8h_source.html">TcpServer.h</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00028">close()</a>, <a class="el" href="TcpServer_8cpp_source.html#l00071">init()</a>, and <a class="el" href="TcpServer_8cpp_source.html#l00164">start_listening()</a>.</p>

</div>
</div>
<a class="anchor" id="a1beafdc19eb3f4e18fb811057afe5f6d"></a><!-- doxytag: member="TcpServer::connections" ref="a1beafdc19eb3f4e18fb811057afe5f6d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">set&lt;boost::shared_ptr&lt;tcp::socket&gt; &gt; <a class="el" href="classTcpServer.html#a1beafdc19eb3f4e18fb811057afe5f6d">TcpServer::connections</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A set of established connections. </p>

<p>Definition at line <a class="el" href="TcpServer_8h_source.html#l00162">162</a> of file <a class="el" href="TcpServer_8h_source.html">TcpServer.h</a>.</p>

<p>Referenced by <a class="el" href="TcpServer_8cpp_source.html#l00028">close()</a>, <a class="el" href="TcpServer_8cpp_source.html#l00275">receive_handler()</a>, and <a class="el" href="TcpServer_8cpp_source.html#l00164">start_listening()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/jtedesco/dev/sockit/src/tcp/<a class="el" href="TcpServer_8h_source.html">TcpServer.h</a></li>
<li>/home/jtedesco/dev/sockit/src/tcp/<a class="el" href="TcpServer_8cpp_source.html">TcpServer.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Mon Aug 1 2011 16:37:53 for SockIt by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
